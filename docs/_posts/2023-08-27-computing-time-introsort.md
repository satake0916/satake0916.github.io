---
layout: post
title: イントロソートに対する計算量の証明
subtitle: なぜO(n log n)に収まるのか？
date: 2023-08-27 09:49:00 +09:00
categories: algorithm
tags: Algorithm, Sort
latex: true
---

あまり計算量の証明について日本語の資料がなかったので、証明部分も含めてイントロソートについてまとめてみます。

## イントロソートのモチベーション

イントロソートとは、クイックソートの改良版として1997年にDavid Musserによって提案されたソートアルゴリズムです。

以降ソート対象の配列の要素数を$n$とします。

クイックソートは期待実行時間が$\Theta(n\log n)$かつ定数部分が極めて小さいため実用上は最も高速であるとされており、さらにその場でソートできる[^1]ため、なるべく使いたい（＝標準ソートとして採用したい）アルゴリズムです。

しかしクイックソートはひとつ欠点があります。それは最悪計算量です。

最悪計算量としては$O(n^2)$となってしまうため、Dos攻撃に利用できるなどセキュリティ上の懸念があります。

そこでクイックソートの実用上優れている点を享受しつつ、最悪計算量は落とすことを目的として提案されたのがイントロソート（Introspective Sort）です。

## アルゴリズム

初めはクイックソートを行い、再帰の深さが要素数の対数$O (\log n)$を超えた後はヒープソートに切り替えるというシンプルなアルゴリズムです。

本題ではないので仔細は省きます。[Wiki][wiki]の疑似コードがわかりやすいと思います。

## 時間計算量

まずはクイックソート部分からです。

ある深さの再帰での比較回数は合計してもは高々$n$回です。また再帰の深さは$O(\log n)$となるように打ち切っているので、クイックソート部分の計算量は$O(n \log n)$であることがわかります。

またヒープソート部分について、ヒープソートで切り替えた時点で要素$k$個に分割されているとすると、各分割の要素数は$n_1, n_2, \cdots, n_k$のように表せます。

各分割$i (i = 1, 2, \cdots, k)$での計算量はヒープソートの性質より$O(n_i \log n_i)$であり、$n_i$の和は$n$であることに注意すると、計算量の和をとっても$O(n \log n)$です。

以上で

- クイックソート部分の計算量が$O (n \log n)$
- ヒープソート部分の計算量が$O (n \log n)$

であることがわかったので、イントロソートの計算量も$O (n \log n)$です。

数式や下限の証明など詳細は割愛します。気になる方は[元論文][source]を読んでみてください。

## 参照

- [Introspective Sorting and Selection Algorithms, DR. Musser(1997)][source]
  - 全編でもそれほど長くない論文なのでおすすめです。
- [アルゴリズムイントロダクション, T. コルメン C.ライザーソン R.リベスト C.シュタイン][book]
  - 主にクイックソートについて参考にしました。
- [イントロソート, Wikipedia][wiki]

[^1]: 配列の中で再配置して実行し、配列外の場所に置かれる要素が高々定数個であること。in-placeともいう。

[wiki]: https://ja.wikipedia.org/wiki/%E3%82%A4%E3%83%B3%E3%83%88%E3%83%AD%E3%82%BD%E3%83%BC%E3%83%88
[source]: https://onlinelibrary.wiley.com/doi/abs/10.1002/%28SICI%291097-024X%28199708%2927%3A8%3C983%3A%3AAID-SPE117%3E3.0.CO%3B2-%23
[book]: https://www.amazon.co.jp/%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0%E3%82%A4%E3%83%B3%E3%83%88%E3%83%AD%E3%83%80%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3-%E7%AC%AC3%E7%89%88-%E7%AC%AC1%E5%B7%BB-%E5%9F%BA%E7%A4%8E%E3%83%BB%E3%82%BD%E3%83%BC%E3%83%88%E3%83%BB%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0%E3%83%BB%E6%95%B0%E5%AD%A6-%E4%B8%96%E7%95%8C%E6%A8%99%E6%BA%96MIT%E6%95%99%E7%A7%91%E6%9B%B8/dp/4764904063/ref=sr_1_3?adgrpid=58778961568&hvadid=667878346284&hvdev=c&hvlocphy=1009507&hvnetw=g&hvqmt=e&hvrand=3516924659548943121&hvtargid=kwd-332250377742&hydadcr=27269_14706076&jp-ad-ap=0&keywords=%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0+%E3%82%A4%E3%83%B3%E3%83%88%E3%83%AD%E3%83%80%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3&qid=1693104625&sr=8-3